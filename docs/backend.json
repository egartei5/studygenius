{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the VitalPrep application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "name": {
          "type": "string",
          "description": "User's full name."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "isPremium": {
          "type": "boolean",
          "description": "Indicates if the user has a premium subscription."
        },
        "subscriptionStatus": {
          "type": "string",
          "description": "The current status of the user's subscription (active, canceled, expired, free, trialing)."
        },
        "planInterval": {
          "type": "string",
          "description": "The billing interval for the subscription (month or year)."
        },
        "currentPeriodEnd": {
          "type": "number",
          "description": "Timestamp indicating the end of the current subscription period."
        },
        "joinedDate": {
          "type": "number",
          "description": "Timestamp indicating when the user joined the application."
        },
        "stats": {
          "type": "string",
          "description": "References UserStats entity (Relationship: User 1:1 UserStats)"
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "isPremium",
        "subscriptionStatus",
        "joinedDate",
        "stats"
      ]
    },
    "UserStats": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserStats",
      "type": "object",
      "description": "Stores usage statistics for a user.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 UserStats)"
        },
        "setsGenerated": {
          "type": "number",
          "description": "Number of study sets generated by the user."
        },
        "questionsAnswered": {
          "type": "number",
          "description": "Number of questions answered by the user."
        },
        "daysStreak": {
          "type": "number",
          "description": "Number of consecutive days the user has used the application."
        },
        "lastLogin": {
          "type": "number",
          "description": "Timestamp of the user's last login."
        }
      },
      "required": [
        "userId",
        "setsGenerated",
        "questionsAnswered",
        "daysStreak",
        "lastLogin"
      ]
    },
    "UserPreferences": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserPreferences",
      "type": "object",
      "description": "Stores user-specific preferences.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 UserPreferences)"
        },
        "lastTopic": {
          "type": "string",
          "description": "The topic that user studied last."
        },
        "lastDifficulty": {
          "type": "string",
          "description": "The difficulty level the user chose last time."
        },
        "lastResourceTypes": {
          "type": "string",
          "description": "Last resource types chosen."
        },
        "darkMode": {
          "type": "boolean",
          "description": "User's preference for dark mode."
        }
      },
      "required": [
        "userId"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Includes fields for subscription status, ensuring Authorization Independence.  ",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, obtained from Firebase Authentication."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/stats",
        "definition": {
          "entityName": "UserStats",
          "schema": {
            "$ref": "#/backend/entities/UserStats"
          },
          "description": "Stores user statistics. Includes userId for relationship and querying. (Relationship: User 1:1 UserStats)",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, obtained from Firebase Authentication."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/preferences",
        "definition": {
          "entityName": "UserPreferences",
          "schema": {
            "$ref": "#/backend/entities/UserPreferences"
          },
          "description": "Stores user preferences. Includes userId for relationship and querying. (Relationship: User 1:1 UserPreferences)",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, obtained from Firebase Authentication."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to securely manage user data, study materials, and application state while adhering to the principles of Authorization Independence and Structural Segregation. User-specific data (profile, stats, preferences) is stored under the `/users/{userId}` path to ensure clear ownership. All documents under a user's path share the same security rules, simplifying access control.\n\nAuthorization Independence is achieved by avoiding hierarchical `get()` calls. For instance, subscription status is stored directly in the user document. This approach ensures that operations like creating a new study set do not require fetching parent document data.\n\nQAPs (Rules are not Filters) is supported through structural segregation and clear ownership. Each user's data is namespaced under their UID, preventing unauthorized listing of other user's private information."
  }
}